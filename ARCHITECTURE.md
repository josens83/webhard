# WeDisk ì•„í‚¤í…ì²˜ ë¬¸ì„œ

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         í´ë¼ì´ì–¸íŠ¸ ë ˆì´ì–´                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ì›¹ ë¸Œë¼ìš°ì €    â”‚   ëª¨ë°”ì¼ ì•±       â”‚    ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ          â”‚
â”‚   (React SPA)   â”‚  (React Native)  â”‚   (React Admin)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                 â”‚                    â”‚
         â”‚    HTTPS/WSS    â”‚                    â”‚
         â–¼                 â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ                         â”‚
â”‚          (SSL/TLS, Rate Limiting, Load Balancing)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼              â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend   â”‚  â”‚   Socket   â”‚  â”‚   MinIO    â”‚  â”‚ Grafana  â”‚
â”‚    API     â”‚  â”‚    .io     â”‚  â”‚    S3      â”‚  â”‚          â”‚
â”‚ (Node.js)  â”‚  â”‚ (ì‹¤ì‹œê°„)    â”‚  â”‚  (íŒŒì¼)     â”‚  â”‚ (ëª¨ë‹ˆí„°ë§) â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚               â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â–¼       â–¼       â–¼        â–¼          â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚PostgreSQLâ”‚ â”‚  Redis   â”‚ â”‚Elastic   â”‚ â”‚Prometheusâ”‚ â”‚  ì™¸ë¶€ API  â”‚
â”‚  (ë©”ì¸DB)â”‚ â”‚ (ìºì‹œ)   â”‚ â”‚ search   â”‚ â”‚ (ë©”íŠ¸ë¦­)  â”‚ â”‚ (ê²°ì œ/OAuth)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ ë ˆì´ì–´ë³„ ìƒì„¸ ì„¤ëª…

### 1. í”„ë ˆì  í…Œì´ì…˜ ë ˆì´ì–´

#### ì›¹ í”„ë¡ íŠ¸ì—”ë“œ (React SPA)
- **ê¸°ìˆ  ìŠ¤íƒ**: React 18, TypeScript, Vite, TailwindCSS
- **ìƒíƒœ ê´€ë¦¬**: Zustand (ë¡œì»¬), React Query (ì„œë²„)
- **ë¼ìš°íŒ…**: React Router v6
- **ì£¼ìš” ê¸°ëŠ¥**:
  - íŒŒì¼ ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ
  - ê²€ìƒ‰ ë° í•„í„°ë§
  - ê²°ì œ ë° ì¶©ì „
  - ì‚¬ìš©ì ì¸ì¦
  - ë‹¤í¬ëª¨ë“œ, ë‹¤êµ­ì–´ ì§€ì›

#### ëª¨ë°”ì¼ ì•± (React Native)
- **ê¸°ìˆ  ìŠ¤íƒ**: React Native 0.73, Expo 50, TypeScript
- **ë„¤ë¹„ê²Œì´ì…˜**: React Navigation
- **ìƒíƒœ ê´€ë¦¬**: Zustand, React Query
- **ë³´ì•ˆ**: Expo SecureStore (í† í° ì €ì¥)
- **ì£¼ìš” í™”ë©´**: 9ê°œ (Login, Register, Home, Files, FileDetail, Search, MyPage, Charge, Upload)

### 2. API ê²Œì´íŠ¸ì›¨ì´ ë ˆì´ì–´

#### Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ
```nginx
ì—­í• :
- SSL/TLS ì¢…ë£Œ
- Rate Limiting (API ë³´í˜¸)
- Load Balancing (Backend 2 replicas)
- Static íŒŒì¼ ìºì‹±
- WebSocket í”„ë¡ì‹œ (Socket.io)
- CORS í—¤ë” ê´€ë¦¬
```

**ì£¼ìš” ì„¤ì •**:
```
/api/*        â†’ Backend API (3000ë²ˆ í¬íŠ¸)
/socket.io/*  â†’ WebSocket (ì‹¤ì‹œê°„ ì•Œë¦¼)
/s3/*         â†’ MinIO S3 (íŒŒì¼ ë‹¤ìš´ë¡œë“œ)
/grafana/*    â†’ Grafana Dashboard
/*            â†’ React Frontend (80ë²ˆ í¬íŠ¸)
```

### 3. ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆì´ì–´

#### Backend API (Node.js + Express)

**ë””ë ‰í† ë¦¬ êµ¬ì¡°**:
```
backend/src/
â”œâ”€â”€ controllers/      # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬
â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”œâ”€â”€ file.controller.ts
â”‚   â”œâ”€â”€ payment.controller.ts
â”‚   â”œâ”€â”€ user.controller.ts
â”‚   â””â”€â”€ admin.controller.ts
â”œâ”€â”€ routes/          # API ë¼ìš°íŠ¸ ì •ì˜
â”‚   â”œâ”€â”€ auth.routes.ts
â”‚   â”œâ”€â”€ file.routes.ts
â”‚   â”œâ”€â”€ search.routes.ts
â”‚   â””â”€â”€ ...
â”œâ”€â”€ services/        # í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ elasticsearch.service.ts  # ê²€ìƒ‰ ì—”ì§„
â”‚   â”œâ”€â”€ socket.service.ts         # ì‹¤ì‹œê°„ ì•Œë¦¼
â”‚   â”œâ”€â”€ payment.service.ts        # ê²°ì œ ì²˜ë¦¬
â”‚   â”œâ”€â”€ fileStorage.service.ts    # íŒŒì¼ ì €ì¥
â”‚   â”œâ”€â”€ twoFactor.service.ts      # 2FA ì¸ì¦
â”‚   â””â”€â”€ imageProcessor.ts         # ì´ë¯¸ì§€ ì²˜ë¦¬
â”œâ”€â”€ middleware/      # Express ë¯¸ë“¤ì›¨ì–´
â”‚   â”œâ”€â”€ auth.ts      # JWT ì¸ì¦
â”‚   â”œâ”€â”€ upload.ts    # íŒŒì¼ ì—…ë¡œë“œ
â”‚   â””â”€â”€ rateLimit.ts # Rate limiting
â”œâ”€â”€ utils/           # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
â””â”€â”€ config/          # ì„¤ì • íŒŒì¼
    â”œâ”€â”€ passport.ts  # OAuth ì„¤ì •
    â””â”€â”€ database.ts  # DB ì—°ê²°
```

**API ì—”ë“œí¬ì¸íŠ¸** (30+):
```
ì¸ì¦:
POST   /api/auth/register        # íšŒì›ê°€ì…
POST   /api/auth/login           # ë¡œê·¸ì¸
GET    /api/auth/me              # í˜„ì¬ ì‚¬ìš©ì
POST   /api/auth/logout          # ë¡œê·¸ì•„ì›ƒ
GET    /api/auth/google          # Google OAuth
GET    /api/auth/kakao           # Kakao OAuth

íŒŒì¼:
GET    /api/files                # íŒŒì¼ ëª©ë¡ (í˜ì´ì§€ë„¤ì´ì…˜)
GET    /api/files/:id            # íŒŒì¼ ìƒì„¸
POST   /api/files/upload         # íŒŒì¼ ì—…ë¡œë“œ
POST   /api/files/:id/download   # íŒŒì¼ ë‹¤ìš´ë¡œë“œ
POST   /api/files/:id/purchase   # íŒŒì¼ êµ¬ë§¤
POST   /api/files/:id/favorite   # ì°œí•˜ê¸°
POST   /api/files/:id/rate       # í‰ê°€

ê²€ìƒ‰:
GET    /api/search               # Elasticsearch ê²€ìƒ‰
GET    /api/search/suggest       # ìë™ì™„ì„±

ê²°ì œ:
POST   /api/payments/request     # ê²°ì œ ìš”ì²­
POST   /api/payments/confirm     # ê²°ì œ í™•ì¸
GET    /api/payments/transactions # ê±°ë˜ ë‚´ì—­

ì‚¬ìš©ì:
GET    /api/users/profile        # í”„ë¡œí•„ ì¡°íšŒ
PUT    /api/users/profile        # í”„ë¡œí•„ ìˆ˜ì •
GET    /api/users/purchases      # êµ¬ë§¤ ë‚´ì—­
GET    /api/users/downloads      # ë‹¤ìš´ë¡œë“œ ë‚´ì—­

ê´€ë¦¬ì:
GET    /api/admin/dashboard      # ëŒ€ì‹œë³´ë“œ í†µê³„
GET    /api/admin/users          # ì‚¬ìš©ì ê´€ë¦¬
GET    /api/admin/files          # íŒŒì¼ ê´€ë¦¬
PUT    /api/admin/files/:id/approve # íŒŒì¼ ìŠ¹ì¸
```

### 4. ë°ì´í„° ë ˆì´ì–´

#### PostgreSQL (ë©”ì¸ ë°ì´í„°ë² ì´ìŠ¤)

**ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ** (15ê°œ ëª¨ë¸):
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User   â”‚â”€â”€â”€â”€â–¶â”‚ Purchase â”‚â—€â”€â”€â”€â”€â”‚   File   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚                 â”‚
     â”‚                â”‚                 â–¼
     â–¼                â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚            â”‚ Category â”‚
â”‚Transactionâ”‚         â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚                 â”‚
     â”‚                â”‚                 â–¼
     â–¼                â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚            â”‚   Tag    â”‚
â”‚  Coupon  â”‚          â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Download â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Comment  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Rating  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì£¼ìš” ëª¨ë¸**:
```prisma
model User {
  id           String   @id @default(uuid())
  email        String   @unique
  username     String   @unique
  password     String
  displayName  String?
  cash         Int      @default(0)
  point        Int      @default(0)
  membership   MembershipLevel @default(BASIC)
  twoFactorSecret String?  # 2FA
  files        File[]
  purchases    Purchase[]
  downloads    Download[]
  comments     Comment[]
  ratings      Rating[]
  favorites    Favorite[]
}

model File {
  id           String   @id @default(uuid())
  title        String
  description  String?
  fileName     String
  filePath     String
  fileSize     BigInt
  mimeType     String
  thumbnailUrl String?
  price        Int      @default(0)
  priceType    PriceType @default(FREE)
  status       FileStatus @default(PENDING)
  downloadCount Int     @default(0)
  viewCount    Int      @default(0)
  ratingAverage Float   @default(0)
  ratingCount  Int      @default(0)
  category     Category @relation(fields: [categoryId])
  user         User     @relation(fields: [userId])
  tags         Tag[]
}
```

#### Redis (ìºì‹± ë° ì„¸ì…˜)

**ìºì‹œ ì „ëµ**:
```
í‚¤ íŒ¨í„´:
- user:{id}           # ì‚¬ìš©ì ì •ë³´ (TTL: 1ì‹œê°„)
- file:{id}           # íŒŒì¼ ë©”íƒ€ë°ì´í„° (TTL: 30ë¶„)
- stats:files         # íŒŒì¼ í†µê³„ (TTL: 5ë¶„)
- popular:files       # ì¸ê¸° íŒŒì¼ (TTL: 10ë¶„)
- search:{query}      # ê²€ìƒ‰ ê²°ê³¼ (TTL: 5ë¶„)

ì„¸ì…˜ ê´€ë¦¬:
- session:{token}     # JWT ì„¸ì…˜ (TTL: 7ì¼)
```

#### Elasticsearch (ê²€ìƒ‰ ì—”ì§„)

**ì¸ë±ìŠ¤ êµ¬ì¡°**:
```json
{
  "mappings": {
    "properties": {
      "title": {
        "type": "text",
        "analyzer": "korean",
        "fields": { "keyword": { "type": "keyword" } }
      },
      "description": { "type": "text", "analyzer": "korean" },
      "category": {
        "properties": {
          "id": { "type": "keyword" },
          "name": { "type": "keyword" }
        }
      },
      "tags": { "type": "keyword" },
      "price": { "type": "integer" },
      "downloadCount": { "type": "integer" },
      "viewCount": { "type": "integer" },
      "ratingAverage": { "type": "float" }
    }
  }
}
```

**ê²€ìƒ‰ ê¸°ëŠ¥**:
- ì „ë¬¸ ê²€ìƒ‰ (Full-text search)
- í•œêµ­ì–´ í˜•íƒœì†Œ ë¶„ì„
- ìë™ì™„ì„± (Auto-suggest)
- í•„í„°ë§ (ì¹´í…Œê³ ë¦¬, íƒœê·¸, ê°€ê²©)
- ì •ë ¬ (ìµœì‹ ìˆœ, ì¸ê¸°ìˆœ, í‰ì ìˆœ)
- í˜ì´ì§€ë„¤ì´ì…˜

### 5. ìŠ¤í† ë¦¬ì§€ ë ˆì´ì–´

#### MinIO (S3 í˜¸í™˜ ê°ì²´ ìŠ¤í† ë¦¬ì§€)

**ë²„í‚· êµ¬ì¡°**:
```
wedisk-files/
â”œâ”€â”€ uploads/              # ì—…ë¡œë“œëœ íŒŒì¼
â”‚   â”œâ”€â”€ {year}/
â”‚   â”‚   â”œâ”€â”€ {month}/
â”‚   â”‚   â”‚   â””â”€â”€ {uuid}.{ext}
â”‚   â””â”€â”€ ...
â”œâ”€â”€ thumbnails/           # ì¸ë„¤ì¼ ì´ë¯¸ì§€
â”‚   â”œâ”€â”€ small/            # 150x150
â”‚   â”œâ”€â”€ medium/           # 300x300
â”‚   â””â”€â”€ large/            # 800x600
â””â”€â”€ temp/                 # ì„ì‹œ íŒŒì¼
```

**íŒŒì¼ ì—…ë¡œë“œ í”Œë¡œìš°**:
```
1. í´ë¼ì´ì–¸íŠ¸ â†’ Backend (Multipart upload)
2. Backend â†’ Sharp (ì´ë¯¸ì§€ ì²˜ë¦¬)
3. Sharp â†’ MinIO (ì›ë³¸ + ì¸ë„¤ì¼ ì €ì¥)
4. MinIO â†’ Signed URL ìƒì„± (ë‹¤ìš´ë¡œë“œìš©)
5. Backend â†’ Elasticsearch (ë©”íƒ€ë°ì´í„° ì¸ë±ì‹±)
6. Backend â†’ PostgreSQL (íŒŒì¼ ì •ë³´ ì €ì¥)
```

### 6. ì‹¤ì‹œê°„ í†µì‹  ë ˆì´ì–´

#### Socket.io (WebSocket)

**ì´ë²¤íŠ¸ êµ¬ì¡°**:
```javascript
ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸:
- 'notification'        # ì¼ë°˜ ì•Œë¦¼
- 'file:approved'       # íŒŒì¼ ìŠ¹ì¸
- 'file:purchased'      # íŒŒì¼ êµ¬ë§¤
- 'payment:completed'   # ê²°ì œ ì™„ë£Œ
- 'upload:progress'     # ì—…ë¡œë“œ ì§„í–‰ë¥ 

í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„:
- 'join:room'           # ë°© ì°¸ì—¬
- 'leave:room'          # ë°© ë‚˜ê°€ê¸°
- 'mark:read'           # ì½ìŒ ì²˜ë¦¬
```

**Room êµ¬ì¡°**:
```
user:{userId}       # ê°œì¸ ì•Œë¦¼
admin:all           # ê´€ë¦¬ì ì „ì²´
seller:{userId}     # íŒë§¤ì ì•Œë¦¼
```

---

## ğŸ” ë³´ì•ˆ ì•„í‚¤í…ì²˜

### ì¸ì¦ ë° ê¶Œí•œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ì¸ì¦ í”Œë¡œìš°                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. í´ë¼ì´ì–¸íŠ¸ â†’ POST /api/auth/login         â”‚
â”‚    { email, password }                       â”‚
â”‚                                              â”‚
â”‚ 2. Backend â†’ Bcrypt ë¹„ë°€ë²ˆí˜¸ ê²€ì¦            â”‚
â”‚                                              â”‚
â”‚ 3. Backend â†’ JWT í† í° ìƒì„±                   â”‚
â”‚    {                                         â”‚
â”‚      userId, email, role,                    â”‚
â”‚      exp: 7ì¼                                â”‚
â”‚    }                                         â”‚
â”‚                                              â”‚
â”‚ 4. Backend â†’ Redis ì„¸ì…˜ ì €ì¥                 â”‚
â”‚    SET session:{token} {userId} EX 604800   â”‚
â”‚                                              â”‚
â”‚ 5. Backend â†’ í´ë¼ì´ì–¸íŠ¸                      â”‚
â”‚    { token, user }                           â”‚
â”‚                                              â”‚
â”‚ 6. í´ë¼ì´ì–¸íŠ¸ â†’ localStorage/SecureStore     â”‚
â”‚    ì €ì¥                                      â”‚
â”‚                                              â”‚
â”‚ 7. ì´í›„ ìš”ì²­ â†’ Authorization: Bearer {token}â”‚
â”‚                                              â”‚
â”‚ 8. Middleware â†’ JWT ê²€ì¦                     â”‚
â”‚    - í† í° ìœ íš¨ì„±                             â”‚
â”‚    - Redis ì„¸ì…˜ í™•ì¸                         â”‚
â”‚    - ì‚¬ìš©ì ê¶Œí•œ í™•ì¸                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2FA (Two-Factor Authentication)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         2FA í™œì„±í™” í”Œë¡œìš°                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ì‚¬ìš©ì â†’ 2FA í™œì„±í™” ìš”ì²­                   â”‚
â”‚                                              â”‚
â”‚ 2. Backend â†’ Speakeasy Secret ìƒì„±           â”‚
â”‚    base32: "JBSWY3DPEHPK3PXP"               â”‚
â”‚                                              â”‚
â”‚ 3. Backend â†’ QR ì½”ë“œ ìƒì„±                    â”‚
â”‚    otpauth://totp/WeDisk:user@example.com   â”‚
â”‚                                              â”‚
â”‚ 4. ì‚¬ìš©ì â†’ Authenticator ì•±ì— ë“±ë¡          â”‚
â”‚    (Google Auth, Authy ë“±)                  â”‚
â”‚                                              â”‚
â”‚ 5. ì‚¬ìš©ì â†’ TOTP ì½”ë“œ ì…ë ¥ (123456)          â”‚
â”‚                                              â”‚
â”‚ 6. Backend â†’ Speakeasy ê²€ì¦                  â”‚
â”‚    verify(secret, token, window: 2)         â”‚
â”‚                                              â”‚
â”‚ 7. Backend â†’ DB ì €ì¥                         â”‚
â”‚    UPDATE user SET twoFactorSecret = secret â”‚
â”‚                                              â”‚
â”‚ 8. Backend â†’ ë°±ì—… ì½”ë“œ ìƒì„± (10ê°œ)            â”‚
â”‚    ["ABC123", "DEF456", ...]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š ëª¨ë‹ˆí„°ë§ ì•„í‚¤í…ì²˜

### Prometheus + Grafana

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Application â”‚ â”€â”€metricsâ”€â”€â–¶ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   (Backend)  â”‚              â”‚ Prometheus â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  (ìˆ˜ì§‘)     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  PostgreSQL  â”‚ â”€â”€metricsâ”€â”€â–¶        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                                     â”‚ scrape
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚ (15s)
â”‚    Redis     â”‚ â”€â”€metricsâ”€â”€â–¶        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚   Nginx      â”‚ â”€â”€metricsâ”€â”€â–¶        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  Grafana   â”‚
                              â”‚ (ì‹œê°í™”)    â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ìˆ˜ì§‘ ë©”íŠ¸ë¦­**:
- API ì‘ë‹µ ì‹œê°„ (p50, p95, p99)
- ìš”ì²­ ì²˜ë¦¬ëŸ‰ (req/sec)
- ì—ëŸ¬ìœ¨ (4xx, 5xx)
- DB ì¿¼ë¦¬ ì„±ëŠ¥
- Redis Hit/Miss Rate
- íŒŒì¼ ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ ì†ë„
- ë©”ëª¨ë¦¬/CPU ì‚¬ìš©ë¥ 

---

## ğŸš€ ë°°í¬ ì•„í‚¤í…ì²˜

### Docker Compose í”„ë¡œë•ì…˜

```yaml
services:
  nginx:        # í”„ë¡ íŠ¸ ê²Œì´íŠ¸ì›¨ì´
  backend:      # API ì„œë²„ (2 replicas)
  frontend:     # React SPA
  postgres:     # ë©”ì¸ DB
  redis:        # ìºì‹œ
  elasticsearch:# ê²€ìƒ‰ ì—”ì§„
  minio:        # íŒŒì¼ ì €ì¥ì†Œ
  prometheus:   # ë©”íŠ¸ë¦­ ìˆ˜ì§‘
  grafana:      # ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ
```

### CI/CD íŒŒì´í”„ë¼ì¸

```
GitHub Push
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GitHub Actions  â”‚
â”‚                 â”‚
â”‚ 1. Checkout     â”‚
â”‚ 2. Setup Node   â”‚
â”‚ 3. Install Deps â”‚
â”‚ 4. Run Tests    â”‚
â”‚ 5. Build        â”‚
â”‚ 6. Docker Build â”‚
â”‚ 7. Push Image   â”‚
â”‚ 8. Deploy       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
Production Server
```

---

## ğŸ“ˆ í™•ì¥ì„± ë° ì„±ëŠ¥

### ìˆ˜í‰ í™•ì¥ (Horizontal Scaling)

```
Load Balancer (Nginx)
         â”‚
    â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
    â–¼    â–¼    â–¼    â–¼    â–¼
Backend Backend Backend Backend
  #1     #2     #3     #4
    â”‚    â”‚    â”‚    â”‚    â”‚
    â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Shared Redis   â”‚
    â”‚  Shared DB      â”‚
    â”‚  Shared MinIO   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ìºì‹± ì „ëµ

```
ìš”ì²­ â†’ Nginx (ì •ì  íŒŒì¼)
    â†“ miss
    â†’ Redis (ë™ì  ë°ì´í„°)
        â†“ miss
        â†’ PostgreSQL (ì›ë³¸)
            â†“
            â†’ Redis ì €ì¥
            â†’ ì‘ë‹µ
```

---

## ğŸ”„ ë°ì´í„° í”Œë¡œìš° ì˜ˆì‹œ

### íŒŒì¼ ë‹¤ìš´ë¡œë“œ í”Œë¡œìš°

```
1. í´ë¼ì´ì–¸íŠ¸ â†’ POST /api/files/:id/download

2. Backend Middleware â†’ JWT ê²€ì¦

3. Backend â†’ PostgreSQL
   SELECT * FROM File WHERE id = :id

4. Backend â†’ PostgreSQL (êµ¬ë§¤ ì—¬ë¶€ í™•ì¸)
   SELECT * FROM Purchase
   WHERE userId = :userId AND fileId = :fileId

5. Backend â†’ MinIO (Signed URL ìƒì„±)
   getSignedUrl(bucket, filePath, expiresIn: 3600)

6. Backend â†’ PostgreSQL (ë‹¤ìš´ë¡œë“œ ê¸°ë¡)
   INSERT INTO Download (...) VALUES (...)

7. Backend â†’ PostgreSQL (ë‹¤ìš´ë¡œë“œ ì¹´ìš´íŠ¸ ì¦ê°€)
   UPDATE File SET downloadCount = downloadCount + 1

8. Backend â†’ Socket.io (íŒë§¤ì ì•Œë¦¼)
   emit('file:downloaded', { fileId, userId })

9. Backend â†’ í´ë¼ì´ì–¸íŠ¸
   { downloadUrl, expiresIn }

10. í´ë¼ì´ì–¸íŠ¸ â†’ MinIO (ì§ì ‘ ë‹¤ìš´ë¡œë“œ)
    GET signed-url
```

---

## ğŸ“ ì½”ë“œ í’ˆì§ˆ

### í…ŒìŠ¤íŠ¸ ì „ëµ

```
ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (Unit Tests)
â”œâ”€â”€ Services
â”‚   â”œâ”€â”€ Payment Service
â”‚   â”œâ”€â”€ File Storage Service
â”‚   â””â”€â”€ Elasticsearch Service
â””â”€â”€ Utilities

í†µí•© í…ŒìŠ¤íŠ¸ (Integration Tests)
â”œâ”€â”€ API Endpoints
â”‚   â”œâ”€â”€ Auth API
â”‚   â”œâ”€â”€ Files API
â”‚   â””â”€â”€ Payment API
â””â”€â”€ Database Operations

E2E í…ŒìŠ¤íŠ¸ (End-to-End)
â””â”€â”€ ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤
    â”œâ”€â”€ íšŒì›ê°€ì… â†’ ë¡œê·¸ì¸
    â”œâ”€â”€ íŒŒì¼ ì—…ë¡œë“œ â†’ ìŠ¹ì¸ â†’ êµ¬ë§¤ â†’ ë‹¤ìš´ë¡œë“œ
    â””â”€â”€ ê²°ì œ í”Œë¡œìš°
```

---

## ğŸ¯ ìµœì í™” í¬ì¸íŠ¸

1. **Database**
   - ì¸ë±ì‹± (user_id, category_id, created_at)
   - Connection Pooling
   - Query ìµœì í™”

2. **Caching**
   - Redis ìºì‹± (íŒŒì¼ ë©”íƒ€ë°ì´í„°, í†µê³„)
   - Nginx ì •ì  íŒŒì¼ ìºì‹±
   - CDN í™œìš© (ì´ë¯¸ì§€, CSS, JS)

3. **Search**
   - Elasticsearch ìƒ¤ë”©
   - ë¹„ë™ê¸° ì¸ë±ì‹±
   - ê²€ìƒ‰ ê²°ê³¼ ìºì‹±

4. **File Storage**
   - Signed URL (ì§ì ‘ ë‹¤ìš´ë¡œë“œ)
   - Multipart Upload (ëŒ€ìš©ëŸ‰)
   - ì¸ë„¤ì¼ ìµœì í™” (Sharp)

5. **API**
   - Rate Limiting
   - Response Compression
   - Pagination
   - Field Selection

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [Prisma ORM ë¬¸ì„œ](https://www.prisma.io/docs)
- [Elasticsearch ê°€ì´ë“œ](https://www.elastic.co/guide)
- [Socket.io ë¬¸ì„œ](https://socket.io/docs)
- [MinIO ë¬¸ì„œ](https://min.io/docs)
- [Nginx ì„¤ì • ê°€ì´ë“œ](https://nginx.org/en/docs)
- [JWT Best Practices](https://tools.ietf.org/html/rfc8725)

---

**ì‘ì„±ì¼**: 2024-11-21
**ë²„ì „**: 1.0
**WeDisk Clone Project**
